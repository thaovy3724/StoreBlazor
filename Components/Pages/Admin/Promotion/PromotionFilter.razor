<!-- Thanh lọc -->
<div class="d-flex flex-wrap gap-2 align-items-center flex-grow-1">
    <!-- Lọc trạng thái -->
    <select class="form-select form-select-sm" style="width: 180px;" 
            @onchange="OnStatusChanged">
        <option value="-1" selected="@(FilterStatus == -1)">Tất cả trạng thái</option>
        <option value="@((int)PromotionStatus.Active)" selected="@(FilterStatus == (int)PromotionStatus.Active)">Hoạt động</option>
        <option value="@((int)PromotionStatus.Inactive)" selected="@(FilterStatus == (int)PromotionStatus.Inactive)">Đã khóa</option>
        <option value="-2" selected="@(FilterStatus == -2)">Hết hạn</option>
    </select>

    <!-- Lọc từ ngày -->
    <div class="input-group input-group-sm" style="width: 200px;">
        <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
        <input type="date" class="form-control" 
               value="@(FromDate?.ToString("yyyy-MM-dd"))"
               @onchange="OnFromDateChanged">
    </div>

    <!-- Lọc đến ngày -->
    <div class="input-group input-group-sm" style="width: 200px;">
        <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
        <input type="date" class="form-control" 
               value="@(ToDate?.ToString("yyyy-MM-dd"))"
               @onchange="OnToDateChanged">
    </div>

    <!-- Ô tìm kiếm -->
    <div class="input-group input-group-sm" style="width: 300px;">
        <input type="text" class="form-control" placeholder="Nhập mã khuyến mãi"
               @bind="searchKeyword"
               @bind:event="oninput"
               @onkeydown="OnKeyDown"
               @onkeydown:preventDefault="shouldPreventDefault">
        <button class="btn btn-primary" type="button" @onclick="HandleSearch">
            <i class="bi bi-search"></i>
        </button>
    </div>
</div>

@code {
    private string searchKeyword = string.Empty;
    private bool shouldPreventDefault = false;

    [Parameter] 
    public string KeyWord { get; set; } = string.Empty;

    [Parameter] 
    public EventCallback<string> KeyWordChanged { get; set; }

    [Parameter] 
    public int FilterStatus { get; set; } = -1;

    [Parameter]
    public EventCallback<int> FilterStatusChanged { get; set; }

    [Parameter] 
    public DateTime? FromDate { get; set; }

    [Parameter] 
    public EventCallback<DateTime?> FromDateChanged { get; set; }

    [Parameter] 
    public DateTime? ToDate { get; set; }

    [Parameter]
    public EventCallback<DateTime?> ToDateChanged { get; set; }

    [Parameter] 
    public EventCallback<int> OnSearch { get; set; }

    protected override void OnParametersSet()
    {
        searchKeyword = KeyWord;
    }

    private async Task OnStatusChanged(ChangeEventArgs e)
    {
        FilterStatus = int.Parse(e.Value?.ToString() ?? "-1");
        await FilterStatusChanged.InvokeAsync(FilterStatus);
        await OnSearch.InvokeAsync(1);
    }

    private async Task OnFromDateChanged(ChangeEventArgs e)
    {
        FromDate = string.IsNullOrEmpty(e.Value?.ToString()) ? null : DateTime.Parse(e.Value.ToString()!);
        await FromDateChanged.InvokeAsync(FromDate);
        await OnSearch.InvokeAsync(1);
    }

    private async Task OnToDateChanged(ChangeEventArgs e)
    {
        ToDate = string.IsNullOrEmpty(e.Value?.ToString()) ? null : DateTime.Parse(e.Value.ToString()!);
        await ToDateChanged.InvokeAsync(ToDate);
        await OnSearch.InvokeAsync(1);
    }

    private async Task HandleSearch()
    {
        await KeyWordChanged.InvokeAsync(searchKeyword);
        await OnSearch.InvokeAsync(1);
    }

    private async Task OnKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            shouldPreventDefault = true;
            await HandleSearch();
        }
        else
        {
            shouldPreventDefault = false;
        }
    }
}