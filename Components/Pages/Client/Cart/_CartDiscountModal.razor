<div class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content border-0 rounded-4">
            <div class="modal-header border-0 bg-light rounded-top-4">
                <h5 class="modal-title fw-bold"><i class="bi bi-ticket-perforated me-2 text-primary"></i>Kho Voucher</h5>
                <button type="button" class="btn-close" @onclick="() => showCouponModal = false"></button>
            </div>

            <div class="modal-body bg-light">
                <div class="mb-3">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
                        <input type="text" class="form-control border-start-0 ps-0" placeholder="Tìm tên mã giảm giá...">
                        <button class="btn btn-outline-secondary">Tìm</button>
                    </div>
                </div>

                <div class="d-flex flex-column gap-3">
                    @foreach (var coupon in availableCoupons)
                    {
                        <div class="card coupon-card border-0 shadow-sm @(coupon.MinOrderValue > SubTotal ? "opacity-50" : "")">
                            <div class="row g-0 align-items-center">
                                <div class="col-3 bg-primary bg-opacity-10 d-flex flex-column align-items-center justify-content-center py-3 border-end border-dashed" style="min-height: 100px;">
                                    <i class="bi bi-gift-fill fs-3 text-primary"></i>
                                    <small class="fw-bold text-primary mt-1">GIẢM</small>
                                </div>
                                <div class="col-9">
                                    <div class="card-body p-2 ps-3">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                <h6 class="card-title fw-bold mb-1">Giảm @coupon.DiscountAmount.ToString("N0")đ</h6>
                                                <p class="card-text text-muted x-small mb-1">Đơn tối thiểu @coupon.MinOrderValue.ToString("N0")đ</p>
                                                <small class="text-danger x-small border border-danger px-1 rounded">HSD: @coupon.ExpiryDate.ToString("dd/MM")</small>
                                            </div>

                                            @if (coupon.MinOrderValue > SubTotal)
                                            {
                                                /* Chưa đủ điều kiện */
                                                <button class="btn btn-sm btn-light text-muted disabled border-0" style="font-size: 0.75rem;">
                                                    Mua thêm
                                                </button>
                                            }
                                            else
                                            {
                                                /* Đủ điều kiện */
                                                <button class="btn btn-sm btn-primary px-3"
                                                        @onclick="() => SelectCouponFromModal(coupon)">
                                                    Dùng ngay
                                                </button>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div class="modal-footer border-top-0 pt-0 bg-light rounded-bottom-4">
                <button class="btn btn-secondary w-100" @onclick="() => showCouponModal = false">Đóng lại</button>
            </div>
        </div>
    </div>
</div>
