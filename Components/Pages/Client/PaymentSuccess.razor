@page "/client/payment-success/{OrderId:int}"
@layout ClientLayout
@inject ICartService CartService

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6">

            <div class="card shadow-lg border-0">
                <div class="card-body text-center p-5">

                    <!-- Icon -->
                    <div class="mb-4">
                        <i class="bi bi-check-circle-fill text-success" style="font-size: 4rem;"></i>
                    </div>

                     <!-- Title -->
                    <h3 class="fw-bold text-success mb-3">Thanh toán thành công!</h3>
                    <p class="fw-semibold text-dark">
                        Mã đơn hàng: <span class="text-primary">#@OrderId</span>
                    </p>
                    <!-- Message -->
                    <p class="text-muted mb-4">
                        Cảm ơn bạn! Đơn hàng của bạn đã được thanh toán thành công.
                        Chúng tôi sẽ xử lý và giao hàng cho bạn trong thời gian sớm nhất.
                    </p>

                    <!-- Back to home button -->
                    <a href="/client" class="btn btn-primary px-4 py-2">
                        <i class="bi bi-house-door-fill me-2"></i>
                        Quay về trang chủ
                    </a>
                </div>
            </div>

        </div>
    </div>
</div>
@code{
    [Parameter] public int OrderId { get; set; }
    private bool _needClear = true;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (_needClear)
        {
            _needClear = false;
            await CartService.ClearCartAsync();

            // *** THÊM PHẦN NÀY ***
            // Thêm một độ trễ ngắn để UI có thời gian xử lý sự kiện OnChange
            await Task.Delay(50);
        }
    }
}